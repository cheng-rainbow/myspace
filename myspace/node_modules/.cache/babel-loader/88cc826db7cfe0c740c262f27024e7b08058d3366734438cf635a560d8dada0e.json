{"ast":null,"code":"import $ from 'jquery';\nimport { jwtDecode } from 'jwt-decode';\nconst modulesUser = {\n  state: {\n    id: \"\",\n    username: \"\",\n    photo: \"\",\n    followerCount: 0,\n    access: \"\",\n    refresh: \"\",\n    is_login: false\n  },\n  getters: {},\n  mutations: {\n    updateUser: (state, user) => {\n      state.id = user.id;\n      state.username = user.username;\n      state.photo = user.photo;\n      state.followerCount = user.followerCount;\n      state.access = user.access;\n      state.refresh = user.refresh;\n      state.is_login = user.is_login;\n    },\n    updateAccess: (state, access) => {\n      state.access = access;\n    }\n  },\n  actions: {\n    login: (context, data) => {\n      $.ajax({\n        url: \"https://app165.acapp.acwing.com.cn/api/token/\",\n        type: \"POST\",\n        data: {\n          username: data.username,\n          password: data.password\n        },\n        success(resp) {\n          const {\n            access,\n            refresh\n          } = resp;\n          const access_obj = jwtDecode(access);\n          setInterval(() => {\n            $.ajax({\n              url: \"https://app165.acapp.acwing.com.cn/api/token/refresh/\",\n              type: \"POST\",\n              data: {\n                refresh\n              },\n              success: () => {\n                context.commit(\"updateAccess\", resp.access);\n              }\n            });\n          }, 4.5 * 60 * 1000);\n          $.ajax({\n            url: \"https://app165.acapp.acwing.com.cn/myspace/getinfo/\",\n            type: \"GET\",\n            data: {\n              user_id: access_obj.user_id\n            },\n            headers: {\n              'Authorization': \"Bearer \" + access\n            },\n            success(resp) {\n              context.commit(\"updateUser\", {\n                ...resp,\n                access: access,\n                refresh: refresh,\n                is_login: true\n              });\n              data.success();\n            }\n          });\n        },\n        error: () => {\n          data.error();\n        }\n      });\n    }\n  },\n  modules: {}\n};\nexport default modulesUser;","map":{"version":3,"names":["$","jwtDecode","modulesUser","state","id","username","photo","followerCount","access","refresh","is_login","getters","mutations","updateUser","user","updateAccess","actions","login","context","data","ajax","url","type","password","success","resp","access_obj","setInterval","commit","user_id","headers","error","modules"],"sources":["D:/a.project.vscode/项目/vue/myspace/src/store/user.js"],"sourcesContent":["import $ from 'jquery';\r\nimport {jwtDecode} from 'jwt-decode';\r\n\r\n\r\n\r\nconst modulesUser = {\r\n    state: {\r\n        id : \"\",\r\n        username : \"\",\r\n        photo : \"\",\r\n        followerCount : 0,\r\n        access: \"\",\r\n        refresh: \"\",\r\n        is_login : false,\r\n    },\r\n\r\n    getters: {\r\n        \r\n    },\r\n\r\n    mutations: {\r\n        updateUser : (state, user) => {\r\n            state.id = user.id;\r\n            state.username = user.username;\r\n            state.photo = user.photo;\r\n            state.followerCount = user.followerCount;\r\n            state.access = user.access;\r\n            state.refresh = user.refresh;\r\n            state.is_login = user.is_login;\r\n        },\r\n\r\n        updateAccess : (state, access) => {\r\n            state.access = access;\r\n        }\r\n    },\r\n\r\n    actions: {\r\n        login : (context, data) => {\r\n            $.ajax({\r\n                url : \"https://app165.acapp.acwing.com.cn/api/token/\",\r\n                type : \"POST\",  \r\n                data : {\r\n                    username : data.username,\r\n                    password : data.password,\r\n                },\r\n                success(resp) {\r\n                    const {access, refresh} = resp;\r\n                    const access_obj = jwtDecode(access);\r\n\r\n                    setInterval(() => {\r\n                        $.ajax({\r\n                            url : \"https://app165.acapp.acwing.com.cn/api/token/refresh/\",\r\n                            type: \"POST\",\r\n                            data : {\r\n                                refresh,\r\n                            },\r\n                            success : () => {\r\n                                context.commit(\"updateAccess\", resp.access);\r\n                            }\r\n                        })\r\n                    }, 4.5 * 60 * 1000);\r\n\r\n\r\n                    $.ajax({\r\n                        url: \"https://app165.acapp.acwing.com.cn/myspace/getinfo/\",\r\n                        type: \"GET\",\r\n                        data : {\r\n                            user_id: access_obj.user_id,\r\n                        },\r\n                        headers: {\r\n                            'Authorization' : \"Bearer \" + access,\r\n                        },\r\n                        success(resp) {\r\n                            context.commit(\"updateUser\", {\r\n                                ...resp,\r\n                                access : access,\r\n                                refresh: refresh,\r\n                                is_login : true,\r\n                            })\r\n                            data.success();\r\n                        }\r\n                    })\r\n                },\r\n                error : () => {\r\n                    \r\n                    data.error();\r\n                }\r\n            })\r\n        }\r\n    },\r\n\r\n    modules: {\r\n    }\r\n}\r\n\r\nexport default modulesUser;\r\n"],"mappings":"AAAA,OAAOA,CAAC,MAAM,QAAQ;AACtB,SAAQC,SAAS,QAAO,YAAY;AAIpC,MAAMC,WAAW,GAAG;EAChBC,KAAK,EAAE;IACHC,EAAE,EAAG,EAAE;IACPC,QAAQ,EAAG,EAAE;IACbC,KAAK,EAAG,EAAE;IACVC,aAAa,EAAG,CAAC;IACjBC,MAAM,EAAE,EAAE;IACVC,OAAO,EAAE,EAAE;IACXC,QAAQ,EAAG;EACf,CAAC;EAEDC,OAAO,EAAE,CAET,CAAC;EAEDC,SAAS,EAAE;IACPC,UAAU,EAAGA,CAACV,KAAK,EAAEW,IAAI,KAAK;MAC1BX,KAAK,CAACC,EAAE,GAAGU,IAAI,CAACV,EAAE;MAClBD,KAAK,CAACE,QAAQ,GAAGS,IAAI,CAACT,QAAQ;MAC9BF,KAAK,CAACG,KAAK,GAAGQ,IAAI,CAACR,KAAK;MACxBH,KAAK,CAACI,aAAa,GAAGO,IAAI,CAACP,aAAa;MACxCJ,KAAK,CAACK,MAAM,GAAGM,IAAI,CAACN,MAAM;MAC1BL,KAAK,CAACM,OAAO,GAAGK,IAAI,CAACL,OAAO;MAC5BN,KAAK,CAACO,QAAQ,GAAGI,IAAI,CAACJ,QAAQ;IAClC,CAAC;IAEDK,YAAY,EAAGA,CAACZ,KAAK,EAAEK,MAAM,KAAK;MAC9BL,KAAK,CAACK,MAAM,GAAGA,MAAM;IACzB;EACJ,CAAC;EAEDQ,OAAO,EAAE;IACLC,KAAK,EAAGA,CAACC,OAAO,EAAEC,IAAI,KAAK;MACvBnB,CAAC,CAACoB,IAAI,CAAC;QACHC,GAAG,EAAG,+CAA+C;QACrDC,IAAI,EAAG,MAAM;QACbH,IAAI,EAAG;UACHd,QAAQ,EAAGc,IAAI,CAACd,QAAQ;UACxBkB,QAAQ,EAAGJ,IAAI,CAACI;QACpB,CAAC;QACDC,OAAOA,CAACC,IAAI,EAAE;UACV,MAAM;YAACjB,MAAM;YAAEC;UAAO,CAAC,GAAGgB,IAAI;UAC9B,MAAMC,UAAU,GAAGzB,SAAS,CAACO,MAAM,CAAC;UAEpCmB,WAAW,CAAC,MAAM;YACd3B,CAAC,CAACoB,IAAI,CAAC;cACHC,GAAG,EAAG,uDAAuD;cAC7DC,IAAI,EAAE,MAAM;cACZH,IAAI,EAAG;gBACHV;cACJ,CAAC;cACDe,OAAO,EAAGA,CAAA,KAAM;gBACZN,OAAO,CAACU,MAAM,CAAC,cAAc,EAAEH,IAAI,CAACjB,MAAM,CAAC;cAC/C;YACJ,CAAC,CAAC;UACN,CAAC,EAAE,GAAG,GAAG,EAAE,GAAG,IAAI,CAAC;UAGnBR,CAAC,CAACoB,IAAI,CAAC;YACHC,GAAG,EAAE,qDAAqD;YAC1DC,IAAI,EAAE,KAAK;YACXH,IAAI,EAAG;cACHU,OAAO,EAAEH,UAAU,CAACG;YACxB,CAAC;YACDC,OAAO,EAAE;cACL,eAAe,EAAG,SAAS,GAAGtB;YAClC,CAAC;YACDgB,OAAOA,CAACC,IAAI,EAAE;cACVP,OAAO,CAACU,MAAM,CAAC,YAAY,EAAE;gBACzB,GAAGH,IAAI;gBACPjB,MAAM,EAAGA,MAAM;gBACfC,OAAO,EAAEA,OAAO;gBAChBC,QAAQ,EAAG;cACf,CAAC,CAAC;cACFS,IAAI,CAACK,OAAO,CAAC,CAAC;YAClB;UACJ,CAAC,CAAC;QACN,CAAC;QACDO,KAAK,EAAGA,CAAA,KAAM;UAEVZ,IAAI,CAACY,KAAK,CAAC,CAAC;QAChB;MACJ,CAAC,CAAC;IACN;EACJ,CAAC;EAEDC,OAAO,EAAE,CACT;AACJ,CAAC;AAED,eAAe9B,WAAW","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}